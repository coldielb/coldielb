<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Story - Jason Weiss Zeledon</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                background-color: #000;
                color: #fff;
                font-family: "JetBrains Mono", monospace;
                line-height: 1.6;
                padding: 2rem;
                max-width: 800px;
                margin: 0 auto;
            }

            .header {
                margin-bottom: 3rem;
                border-bottom: 1px solid #333;
                padding-bottom: 2rem;
            }

            .site-title {
                font-size: 2.5rem;
                font-weight: 700;
                margin-bottom: 0.5rem;
                background: linear-gradient(135deg, #00ffff, #8a2be2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .site-subtitle {
                font-size: 1.2rem;
                font-weight: 400;
                margin-bottom: 1rem;
                color: #888;
            }

            .nav {
                display: flex;
                gap: 2rem;
                font-size: 0.9rem;
            }

            .nav a {
                color: #888;
                text-decoration: none;
                transition: color 0.2s ease;
            }

            .nav a:hover {
                color: #8a2be2;
            }

            .nav a.active {
                background: linear-gradient(135deg, #00ffff, #8a2be2);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .loading {
                text-align: center;
                color: #888;
                font-style: italic;
                padding: 3rem;
            }

            .error {
                color: #ff6b6b;
                text-align: center;
                padding: 2rem;
                border: 1px solid #ff6b6b;
                border-radius: 0.5rem;
                background-color: rgba(255, 107, 107, 0.1);
            }

            .back-link {
                display: inline-block;
                margin-bottom: 2rem;
                color: #8a2be2;
                text-decoration: none;
                font-size: 0.9rem;
                transition: color 0.2s ease;
            }

            .back-link:hover {
                color: #00ffff;
            }

            .back-link::before {
                content: "← ";
            }

            .story-content {
                max-width: 800px;
                margin: 0 auto;
                padding: 0;
                font-family: "JetBrains Mono", monospace;
                line-height: 1.6;
                color: #fff;
                background-color: #000;
            }

            .story-meta {
                border-bottom: 1px solid #333;
                padding-bottom: 1rem;
                margin-bottom: 2rem;
            }

            .story-title {
                font-size: 2rem;
                font-weight: 700;
                margin-bottom: 0.5rem;
                background: linear-gradient(135deg, #8a2be2, #00ffff);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .story-meta-info {
                display: flex;
                gap: 1rem;
                font-size: 0.9rem;
                color: #888;
                flex-wrap: wrap;
                margin-bottom: 1rem;
            }

            .story-tags {
                display: flex;
                gap: 0.5rem;
                margin-top: 0.5rem;
                flex-wrap: wrap;
            }

            .story-tag {
                background-color: #111;
                color: #8a2be2;
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
                font-size: 0.8rem;
                border: 1px solid #333;
            }

            /* Blog content styles from col-parser */
            .blog-heading {
                background: linear-gradient(135deg, #8a2be2, #00ffff);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin: 2rem 0 1rem 0;
                font-weight: 600;
            }

            .blog-heading:first-child {
                margin-top: 0;
            }

            .blog-paragraph {
                margin: 1rem 0;
                color: #ccc;
            }

            .blog-bold {
                font-weight: 600;
                background: linear-gradient(135deg, #8a2be2, #00ffff);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .blog-italic {
                font-style: italic;
                color: #aaa;
            }

            .blog-inline-code {
                background-color: #111;
                color: #8a2be2;
                padding: 0.2rem 0.4rem;
                border-radius: 0.25rem;
                font-size: 0.9em;
                border: 1px solid #333;
            }

            .blog-code-block {
                background-color: #111;
                color: #ccc;
                padding: 1rem;
                border-radius: 0.5rem;
                overflow-x: auto;
                margin: 1.5rem 0;
                border: 1px solid #333;
            }

            .blog-code {
                font-family: "JetBrains Mono", monospace;
                font-size: 0.9em;
            }

            .blog-link {
                color: #8a2be2;
                text-decoration: none;
                border-bottom: 1px solid transparent;
                transition: border-color 0.2s ease;
            }

            .blog-link:hover {
                border-bottom-color: #8a2be2;
            }

            .blog-image {
                max-width: 100%;
                height: auto;
                border-radius: 0.5rem;
                margin: 1rem 0;
                border: 1px solid #333;
            }

            .blog-list {
                margin: 1rem 0;
                padding-left: 2rem;
            }

            .blog-list-item {
                margin: 0.5rem 0;
                color: #ccc;
            }

            .blog-ordered-list {
                list-style-type: decimal;
            }

            .blog-blockquote {
                border-left: 4px solid #8a2be2;
                padding-left: 1rem;
                margin: 1.5rem 0;
                color: #aaa;
                font-style: italic;
            }

            .blog-hr {
                border: none;
                height: 1px;
                background: linear-gradient(135deg, #8a2be2, #00ffff);
                margin: 2rem 0;
            }

            @media (max-width: 768px) {
                body {
                    padding: 1rem;
                }
                
                .story-title {
                    font-size: 1.5rem;
                }
                
                .story-meta-info {
                    flex-direction: column;
                    gap: 0.5rem;
                }
                
                .blog-list {
                    padding-left: 1.5rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1 class="site-title">Jason Weiss Zeledon</h1>
            <p class="site-subtitle">Full Stack Developer</p>
            <nav class="nav">
                <a href="index.html">Home</a>
                <a href="blog.html">Blog</a>
                <a href="stories.html" class="active">Creative Works</a>
            </nav>
        </div>

        <a href="stories.html" class="back-link">Back to Creative Works</a>

        <div id="storyContainer">
            <div class="loading">Loading story...</div>
        </div>

        <script src="js/col-parser.js"></script>
        <script>
            class StoryViewer {
                constructor() {
                    this.parser = new ColParser();
                    this.container = document.getElementById('storyContainer');
                    this.slug = this.getSlugFromUrl();
                    
                    this.init();
                }

                getSlugFromUrl() {
                    const urlParams = new URLSearchParams(window.location.search);
                    return urlParams.get('slug');
                }

                async init() {
                    if (!this.slug) {
                        this.showError('No story specified');
                        return;
                    }

                    try {
                        await this.loadStory(this.slug);
                    } catch (error) {
                        this.showError(`Failed to load story: ${error.message}`);
                    }
                }

                async loadStory(slug) {
                    try {
                        const filename = `${slug}.col`;
                        const story = await this.parser.loadFile(`stories/${filename}`);
                        
                        // Ensure metadata.tags is always an array
                        if (!story.metadata.tags || !Array.isArray(story.metadata.tags)) {
                            story.metadata.tags = [];
                        }
                        
                        this.renderStory(story);
                        this.updatePageTitle(story.metadata.title);
                    } catch (error) {
                        throw new Error(`Could not load story "${slug}": ${error.message}`);
                    }
                }

                updatePageTitle(title) {
                    document.title = `${title} - Jason Weiss Zeledon`;
                }

                renderStory(story) {
                    const formattedDate = new Date(story.metadata.date).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    this.container.innerHTML = `
                        <article class="story-content">
                            <div class="story-meta">
                                <h1 class="story-title">${this.escapeHtml(story.metadata.title)}</h1>
                                <div class="story-meta-info">
                                    <span>By ${this.escapeHtml(story.metadata.author)}</span>
                                    <span>${formattedDate}</span>
                                    <span>${story.wordCount} words</span>
                                    <span>${story.estimatedReadTime} min read</span>
                                </div>
                                ${story.metadata.tags && story.metadata.tags.length > 0 ? `
                                    <div class="story-tags">
                                        ${story.metadata.tags.map(tag => 
                                            `<span class="story-tag">${this.escapeHtml(tag)}</span>`
                                        ).join('')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="story-body">
                                ${story.content}
                            </div>
                        </article>
                    `;
                }

                escapeHtml(text) {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                }

                showError(message) {
                    this.container.innerHTML = `
                        <div class="error">
                            <strong>Error:</strong> ${this.escapeHtml(message)}
                            <br><br>
                            <a href="stories.html" style="color: #8a2be2;">← Back to Creative Works</a>
                        </div>
                    `;
                }
            }

            // Initialize story viewer when DOM is loaded
            document.addEventListener('DOMContentLoaded', () => {
                new StoryViewer();
            });
        </script>
    </body>
</html>